<div *ngIf="employee; else loading" class="container mt-4">
  <div class="row">
    <!-- Left Side: Profile Info -->
    <div class="col-md-4">
      <div class="card shadow p-4 text-center">
<img [src]="getProfilePic()" 
     alt="Profile Picture" 
     class="profile-pic">
        <h3>{{ employee.nm }}</h3>
        <p class="text-muted">{{ employee.designationnm }} - {{ employee.departmentnm }}</p>
        <hr>
        <p><b>Employee ID:</b> {{ employee.id }}</p>
        <p><b>Email:</b> {{ employee.email }}</p>
        <p><b>Mobile:</b> {{ employee.mobile }}</p>
        <p><b>Basic Salary:</b> {{ employee.basicSalary }}</p>
        <p><b>PF:</b> {{ employee.pf }}</p>
        <p><b>Joining Date:</b> {{ employee.joiningDate }}</p>
      </div>
    </div>

    <!-- Right Side: Tabs -->
    <div class="col-md-8">
      <ul ngbNav #nav="ngbNav" [(activeId)]="activeTab" (navChange)="onTabChange($event)" class="nav-tabs">

        <!-- Salary Tab -->
        <!-- Salary Tab -->
<li [ngbNavItem]="1">
  <button ngbNavLink>Salary</button>
  <ng-template ngbNavContent>

    <!-- Month & Year Selection -->
    <div class="d-flex gap-2 mb-3 align-items-center">
      <label class="mb-0"><b>Month:</b></label>
      <select class="form-select w-auto" [(ngModel)]="selectedMonth" (change)="loadSalary()">
        <option *ngFor="let m of months" [value]="m.value">{{ m.name }}</option>
      </select>

      <label class="mb-0"><b>Year:</b></label>
      <select class="form-select w-auto" [(ngModel)]="selectedYear" (change)="loadSalary()">
        <option *ngFor="let y of years" [value]="y">{{ y }}</option>
      </select>
    </div>

<div *ngIf="salary; else noSalary">

  <p><b>Employee Name&nbsp;:</b>&nbsp;{{ salary.employeeName }}</p>
<p><b>Department&nbsp;:</b>&nbsp;{{ salary.departmentName }}</p>
<p><b>Basic Salary&nbsp;:</b>&nbsp;{{ salary.basicSalary }}</p>
<p><b>Allowances&nbsp;:</b>&nbsp;{{ salary.allowances }}</p>
<p><b>Deductions&nbsp;:</b>&nbsp;{{ salary.deductions }}</p>

<ng-container *ngIf="isPaid === true">
  <p><b>Pay Date&nbsp;:</b>&nbsp;{{ salary.payDate | date:'dd/MM/yyyy' }}</p>
</ng-container>

<p>
  <b>Payment Status&nbsp;:</b>&nbsp;
  <ng-container *ngIf="isPaid === true">
    <img src="assets/image/paidimage.jpeg" alt="Paid" width="70">
  </ng-container>
  <ng-container *ngIf="isPaid === false">
    <img src="assets/image/unpaid.jpeg" alt="Unpaid" width="70">
  </ng-container>
</p>

</div>

<ng-template #noSalary>
  <div class="alert alert-warning mt-3 text-center">
    No salary record found for the selected month/year.
  </div>
</ng-template>

  </ng-template>
</li>


        <!-- Attendance Tab -->
        <li [ngbNavItem]="2">
          <button ngbNavLink>Attendance</button>
          <ng-template ngbNavContent>
            <h4 class="mt-3">Saved Attendance Records</h4>
            <table class="table table-striped table-bordered">
              <thead class="table-secondary">
                <tr>
                  <th>Employee ID</th>
                  <th>Name</th>
                  <th>Date</th>
                  <th>In Time</th>
                  <th>Out Time</th>
                  <th>Status</th>
                  <th>Total Time</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let att of filteredAttendance">
                  <td>{{ att.uid || att.Uid || att.Id }}</td>
                  <td>{{ att.unm || att.Unm || att.employeeName }}</td>
                  <td>{{ att.dt ? (att.dt | date:'shortDate') : (att.Dt | date:'shortDate') }}</td>
                  <td>{{ att.inTime || att.InTime }}</td>
                  <td>{{ att.outTime || att.OutTime }}</td>
                  <td>{{ att.status == '1' || att.Status == 1 ? 'Present' : 'Absent' }}</td>
                  <td>{{ att.totalTime || att.TotalTime }}</td>
                </tr>
                <tr *ngIf="filteredAttendance.length === 0">
                  <td colspan="7" class="text-center">No attendance records found.</td>
                </tr>
              </tbody>
            </table>
          </ng-template>
        </li>

        <!-- Payments Tab -->
        <li [ngbNavItem]="3">
          <button ngbNavLink>Payments</button>
          <ng-template ngbNavContent>
            <div class="p-3">
              <h5>Payments History</h5>

              <div *ngIf="loadingPayments" class="text-center p-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>

              <table class="table table-bordered" *ngIf="!loadingPayments && payments.length > 0">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Employee</th>
                    <th>Department</th>
                    <th>Net Salary</th>
                    <th>Pay Date</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let p of payments">
                    <td>{{ p.id }}</td>
                    <td>{{ p.employeeName }}</td>
                    <td>{{ p.departmentName }}</td>
                    <td>{{ getNet(p) | number:'1.2-2' }}</td>
                    <td>{{ p.payDate | date:'dd-MMM-yyyy' }}</td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary" (click)="viewSlip(p)">
                        View Slip
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>

              <div *ngIf="!loadingPayments && payments.length === 0" class="alert alert-info">
                No payments found for this employee.
              </div>
            </div>

            <!-- Salary Slip Modal -->
            <div class="modal fade show d-block" tabindex="-1" *ngIf="showModal" style="background:rgba(0,0,0,0.5);">
              <div class="modal-dialog modal-lg">
                <div class="modal-content p-4">
                  <div class="modal-header">
                    <h5 class="modal-title">Salary Slip</h5>
                    <button type="button" class="btn-close" (click)="closeModal()"></button>
                  </div>

                  <div class="modal-body" *ngIf="selectedSlip">
                    <div class="border p-4" style="font-family: Arial, sans-serif;">
                      <div class="text-center mb-3">
                        <h3 class="m-0">Abhishek IT Soln </h3>
                        <small>[Write Street Address Here]</small>
                      </div>

                      <div class="mb-3">
                        <p><strong>Employee Name:</strong> {{ selectedSlip.employeeName }}</p>
                        <p><strong>Designation:</strong> {{ selectedSlip.designation || '-' }}</p>
                        <p>
                          <strong>Month:</strong> {{ selectedSlip.payDate | date:'MMM' }}
                          <strong>Year:</strong> {{ selectedSlip.payDate | date:'yyyy' }}
                        </p>
                      </div>

                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Earnings</th>
                            <th>Amount</th>
                            <th>Deductions</th>
                            <th>Amount</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>Basic Salary</td>
                            <td>{{ selectedSlip.basicSalary | number:'1.2-2' }}</td>
                            <td>Deductions</td>
                            <td>{{ selectedSlip.deductions | number:'1.2-2' }}</td>
                          </tr>
                          <tr>
                            <td>Allowances</td>
                            <td>{{ selectedSlip.allowances | number:'1.2-2' }}</td>
                            <td colspan="2"></td>
                          </tr>
                          <tr class="table-light fw-bold">
                            <td>Total Addition</td>
                            <td>{{ (selectedSlip.basicSalary + selectedSlip.allowances) | number:'1.2-2' }}</td>
                            <td>Total Deduction</td>
                            <td>{{ selectedSlip.deductions | number:'1.2-2' }}</td>
                          </tr>
                          <tr class="table-light fw-bold">
                            <td colspan="2">NET Salary</td>
                            <td colspan="2">{{ getNet(selectedSlip) | number:'1.2-2' }}</td>
                          </tr>
                        </tbody>
                      </table>

                      <p class="mt-3"><strong>Pay Date:</strong> {{ selectedSlip.payDate | date:'dd-MMM-yyyy' }}</p>
                      <p><strong>Bank:</strong> {{ selectedSlip.bankName || 'N/A' }}</p>
                      <p><strong>Cheque #:</strong> {{ selectedSlip.chequeNo || 'N/A' }}</p>

                      <div class="row mt-4">
                        <div class="col text-center">
                          <p>____________________</p>
                          <p><strong>Employee Signature</strong></p>
                        </div>
                        <div class="col text-center">
                          <p>____________________</p>
                          <p><strong>Director</strong></p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="modal-footer">
                    <button class="btn btn-secondary" (click)="closeModal()">Close</button>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>
        </li>

        <!-- Ratings Tab -->
        <li [ngbNavItem]="4">
          <button ngbNavLink>Ratings</button>
          <ng-template ngbNavContent>
            <div class="p-3">
              <h5 class="mb-3">Performance Ratings</h5>

              <div *ngIf="ratings.length > 0; else noRatings">
                <div class="list-group">
                  <div *ngFor="let r of ratings" class="list-group-item">
                    <div class="d-flex justify-content-between align-items-center">
                      <strong>⭐ {{ r.score }}/5</strong>
                      <small>{{ r.ratingDate | date:'dd-MMM-yyyy' }}</small>
                    </div>
                    <p class="mb-0 mt-2">{{ r.comments }}</p>
                  </div>
                </div>
              </div>

              <ng-template #noRatings>
                <p class="text-muted">{{ ratingError || 'No ratings available.' }}</p>
              </ng-template>
            </div>
          </ng-template>
        </li>
      </ul>

      <div [ngbNavOutlet]="nav" class="mt-2 border rounded p-3 shadow-sm"></div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="text-center mt-5">
    <p>Loading employee details...</p>
  </div>
</ng-template>
<!-- Back Button -->
<div class="text-end mt-3">
  <button class="btn btn-primary" (click)="goToEmployeeTab()">
    ← Back to Employee Details
  </button>
</div>

